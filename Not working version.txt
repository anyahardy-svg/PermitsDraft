import React, { useState } from 'react';
import { useEffect } from 'react';
import { StyleSheet, View, TouchableOpacity, Text, TextInput, Switch, FlatList, ScrollView, Alert, Modal } from 'react-native';

// Custom DateTimePicker Component
const DateTimePicker = ({ visible, onClose, onSelect, mode = 'date', currentValue }) => {
  const [selectedDate, setSelectedDate] = useState(currentValue ? new Date(currentValue) : new Date());
  const [tempHour, setTempHour] = useState(selectedDate.getHours());
  const [tempMinute, setTempMinute] = useState(selectedDate.getMinutes());

  const formatDate = (date) => {
    return date.toISOString().split('T')[0];
  };

  const formatTime = (hour, minute) => {
    return `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
  };

  const handleConfirm = () => {
    if (mode === 'date') {
      onSelect(formatDate(selectedDate));
    } else {
      onSelect(formatTime(tempHour, tempMinute));
    }
    onClose();
  };

  const renderDatePicker = () => (
    <View style={pickerStyles.dateContainer}>
      <View style={pickerStyles.dateHeader}>
        <TouchableOpacity onPress={() => {
          const newDate = new Date(selectedDate);
          newDate.setFullYear(newDate.getFullYear() - 1);
          setSelectedDate(newDate);
        }}>
          <Text style={pickerStyles.yearButton}>◀ {selectedDate.getFullYear() - 1}</Text>
        </TouchableOpacity>
        <Text style={pickerStyles.currentYear}>{selectedDate.getFullYear()}</Text>
        <TouchableOpacity onPress={() => {
          const newDate = new Date(selectedDate);
          newDate.setFullYear(newDate.getFullYear() + 1);
          setSelectedDate(newDate);
        }}>
          <Text style={pickerStyles.yearButton}>{selectedDate.getFullYear() + 1} ▶</Text>
        </TouchableOpacity>
      </View>
      <View style={pickerStyles.monthContainer}>
        {['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'].map((month, index) => (
          <TouchableOpacity
            key={month}
            style={[
              pickerStyles.monthButton,
              selectedDate.getMonth() === index && pickerStyles.selectedMonth
            ]}
            onPress={() => {
              const newDate = new Date(selectedDate);
              newDate.setMonth(index);
              setSelectedDate(newDate);
            }}
          >
            <Text style={[
              pickerStyles.monthText,
              selectedDate.getMonth() === index && pickerStyles.selectedMonthText
            ]}>
              {month}
            </Text>
          </TouchableOpacity>
        ))}
      </View>
      <View style={pickerStyles.dayContainer}>
        {Array.from({ length: new Date(selectedDate.getFullYear(), selectedDate.getMonth() + 1, 0).getDate() }, (_, i) => i + 1).map(day => (
          <TouchableOpacity
            key={day}
            style={[
              pickerStyles.dayButton,
              selectedDate.getDate() === day && pickerStyles.selectedDay
            ]}
            onPress={() => {
              const newDate = new Date(selectedDate);
              newDate.setDate(day);
              setSelectedDate(newDate);
            }}
          >
            <Text style={[
              pickerStyles.dayText,
              selectedDate.getDate() === day && pickerStyles.selectedDayText
            ]}>
              {day}
            </Text>
          </TouchableOpacity>
        ))}
      </View>
    </View>
  );

  const renderTimePicker = () => (
    <View style={pickerStyles.timeContainer}>
      <View style={pickerStyles.timeSection}>
        <Text style={pickerStyles.timeLabel}>Hour</Text>
        <ScrollView style={pickerStyles.timeScroll} showsVerticalScrollIndicator={false}>
          {Array.from({ length: 24 }, (_, i) => i).map(hour => (
            <TouchableOpacity
              key={hour}
              style={[
                pickerStyles.timeOption,
                tempHour === hour && pickerStyles.selectedTimeOption
              ]}
              onPress={() => setTempHour(hour)}
            >
              <Text style={[
                pickerStyles.timeOptionText,
                tempHour === hour && pickerStyles.selectedTimeOptionText
              ]}>
                {hour.toString().padStart(2, '0')}
              </Text>
            </TouchableOpacity>
          ))}
        </ScrollView>
      </View>
      <Text style={pickerStyles.timeSeparator}>:</Text>
      <View style={pickerStyles.timeSection}>
        <Text style={pickerStyles.timeLabel}>Minute</Text>
        <ScrollView style={pickerStyles.timeScroll} showsVerticalScrollIndicator={false}>
          {Array.from({ length: 60 }, (_, i) => i).filter(minute => minute % 5 === 0).map(minute => (
            <TouchableOpacity
              key={minute}
              style={[
                pickerStyles.timeOption,
                tempMinute === minute && pickerStyles.selectedTimeOption
              ]}
              onPress={() => setTempMinute(minute)}
            >
              <Text style={[
                pickerStyles.timeOptionText,
                tempMinute === minute && pickerStyles.selectedTimeOptionText
              ]}>
                {minute.toString().padStart(2, '0')}
              </Text>
            </TouchableOpacity>
          ))}
        </ScrollView>
      </View>
    </View>
  );

  return (
    <Modal visible={visible} transparent animationType="slide">
      <View style={pickerStyles.overlay}>
        <View style={pickerStyles.modal}>
          <View style={pickerStyles.header}>
            <Text style={pickerStyles.title}>
              {mode === 'date' ? 'Select Date' : 'Select Time'}
            </Text>
          </View>
          {mode === 'date' ? renderDatePicker() : renderTimePicker()}
          <View style={pickerStyles.buttonContainer}>
            <TouchableOpacity style={pickerStyles.cancelButton} onPress={onClose}>
              <Text style={pickerStyles.cancelButtonText}>Cancel</Text>
            </TouchableOpacity>
            <TouchableOpacity style={pickerStyles.confirmButton} onPress={handleConfirm}>
              <Text style={pickerStyles.confirmButtonText}>Confirm</Text>
            </TouchableOpacity>
          </View>
        </View>
      </View>
    </Modal>
  );
};

// ...rest of the backup file content (all logic, UI, styles, and export default PermitManagementApp) pasted here...